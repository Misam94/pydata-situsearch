from infrastructure import MetricaParser

SAMPLE_AWAY = """,,,Away,,Away,,Away,,Away,,Away,,Away,,Away,,Away,,Away,,Away,,Away,,Away,,Away,,Away,,Away,
,,,25,,15,,16,,17,,18,,19,,20,,21,,22,,23,,24,,26,,27,,28,,,
Period,Frame,Time [s],Player25,,Player15,,Player16,,Player17,,Player18,,Player19,,Player20,,Player21,,Player22,,Player23,,Player24,,Player26,,Player27,,Player28,,Ball,
1,1,0.04,0.90509,0.47462,0.58393,0.20794,0.67658,0.4671,0.6731,0.76476,0.40783,0.61525,0.45472,0.38709,0.5596,0.67775,0.55243,0.43269,0.50067,0.94322,0.43693,0.05002,0.37833,0.27383,NaN,NaN,NaN,NaN,NaN,NaN,0.45472,0.38709
1,2,0.08,0.90494,0.47462,0.58393,0.20794,0.67658,0.4671,0.6731,0.76476,0.40783,0.61525,0.45472,0.38709,0.5596,0.67775,0.55243,0.43269,0.50067,0.94322,0.43693,0.05002,0.37833,0.27383,NaN,NaN,NaN,NaN,NaN,NaN,0.49645,0.40656
1,3,0.12,0.90434,0.47463,0.58393,0.20794,0.67658,0.4671,0.6731,0.76476,0.40783,0.61525,0.45472,0.38709,0.5596,0.67775,0.55243,0.43269,0.50067,0.94322,0.43693,0.05002,0.37833,0.27383,NaN,NaN,NaN,NaN,NaN,NaN,0.53716,0.42556
1,4,0.16,0.90377,0.47463,0.58351,0.20868,0.6764,0.46762,0.67279,0.76542,0.40771,0.61505,0.45454,0.38818,0.55974,0.67776,0.55236,0.43313,0.50034,0.94391,0.43644,0.05038,0.37756,0.27473,NaN,NaN,NaN,NaN,NaN,NaN,0.55346,0.42231
1,5,0.2,0.90324,0.47464,0.58291,0.21039,0.67599,0.46769,0.67253,0.76564,0.40736,0.61471,0.45426,0.38725,0.55992,0.67791,0.55202,0.43311,0.50017,0.94434,0.4358,0.04977,0.37663,0.27543,NaN,NaN,NaN,NaN,NaN,NaN,0.55512,0.4057
1,6,0.24,0.90275,0.47464,0.58214,0.21123,0.67537,0.46727,0.67194,0.76519,0.40697,0.61309,0.45397,0.38621,0.56017,0.67676,0.55157,0.43257,0.49989,0.94432,0.43504,0.04884,0.37557,0.27673,NaN,NaN,NaN,NaN,NaN,NaN,0.55677,0.38909
"""

SAMPLE_HOME = """,,,Home,,Home,,Home,,Home,,Home,,Home,,Home,,Home,,Home,,Home,,Home,,Home,,Home,,Home,,,
,,,11,,1,,2,,3,,4,,5,,6,,7,,8,,9,,10,,12,,13,,14,,,
Period,Frame,Time [s],Player11,,Player1,,Player2,,Player3,,Player4,,Player5,,Player6,,Player7,,Player8,,Player9,,Player10,,Player12,,Player13,,Player14,,Ball,
1,1,0.04,0.00082,0.48238,0.32648,0.65322,0.33701,0.48863,0.30927,0.35529,0.32137,0.21262,0.41094,0.72589,0.41698,0.47843,0.39125,0.3255,0.45388,0.21174,0.52697,0.3798,0.55243,0.43269,NaN,NaN,NaN,NaN,NaN,NaN,0.45472,0.38709
1,2,0.08,0.00096,0.48238,0.32648,0.65322,0.33701,0.48863,0.30927,0.35529,0.32137,0.21262,0.41094,0.72589,0.41698,0.47843,0.39125,0.3255,0.45388,0.21174,0.52697,0.3798,0.55243,0.43269,NaN,NaN,NaN,NaN,NaN,NaN,0.49645,0.40656
1,3,0.12,0.00114,0.48238,0.32648,0.65322,0.33701,0.48863,0.30927,0.35529,0.32137,0.21262,0.41094,0.72589,0.41698,0.47843,0.39125,0.3255,0.45388,0.21174,0.52697,0.3798,0.55243,0.43269,NaN,NaN,NaN,NaN,NaN,NaN,0.53716,0.42556
1,4,0.16,0.00121,0.48238,0.32622,0.65317,0.33687,0.48988,0.30944,0.35554,0.32142,0.21241,0.41067,0.72565,0.41703,0.47965,0.39134,0.32566,0.45379,0.21053,0.52731,0.3801,0.55236,0.43313,NaN,NaN,NaN,NaN,NaN,NaN,0.55346,0.42231
1,5,0.2,0.00129,0.48238,0.32597,0.65269,0.33664,0.49018,0.30948,0.35528,0.32136,0.21159,0.41065,0.7251,0.41682,0.47952,0.39141,0.32427,0.45376,0.2095,0.52737,0.37991,0.55202,0.43311,NaN,NaN,NaN,NaN,NaN,NaN,0.55512,0.4057
1,6,0.24,0.0014,0.48238,0.32581,0.65159,0.33637,0.48966,0.30978,0.35479,0.32159,0.21051,0.41082,0.72439,0.41663,0.4782,0.3919,0.32322,0.4538,0.20788,0.5274,0.37849,0.55256,0.42793,NaN,NaN,NaN,NaN,NaN,NaN,0.55677,0.38909
"""


class TestMetricaParser:
    def test_metrica_parser(self):
        parser = MetricaParser()
        dataset = parser.parse(
            SAMPLE_HOME, SAMPLE_AWAY,
            sample_rate=1,
            dataset_id="test"
        )

        assert len(dataset.frames) == 6
        assert len(dataset.frames[0].home_player_coordinates) == 11
        assert len(dataset.frames[0].away_player_coordinates) == 11
